{% extends 'salary/logined_page.html' %}
{% load humanize %}
{% load salary_tags %}

{% block content %}
<main>
  <div class="container">
    <div class="row mt-1">
      <div class="col">
        <p class="text-center">Аналитический отчет за {{ current_month_date|date:"F Y г." }}</p>
      </div>
    </div>
    <div class="row mb-2">
      <div class="col">
        <button class="btn btn-outline-secondary" onclick="history.back()">Назад</button>
      </div>
    </div>
    <div class="row mb-2 row-cols-md-2 row-cols-sm-1 m-1 justify-content-center">
      <div class="col-md-5 col-sm-12 m-2 table-responsive rounded border border-light">
        <p class="text-orange text-center fw-bold">Аналитика по выручке</p>
        <table class="table table-dark">
          <thead class="text-warning text-center">
            <tr>
              <th>Показатель</th>
              <th>{{ previous_month_date|date:"F" }}</th>
              <th>{{ current_month_date|date:"F" }}</th>
              <th>Анализ</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr>
              <td>Общая выручка</td>
              <td>{{ analytic.summary_revenue__sum.0 | intcomma }}</td>
              <td>{{ analytic.summary_revenue__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.summary_revenue__sum.0 < analytic.summary_revenue__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.summary_revenue__sum.2 }}%</span>
                {% elif analytic.summary_revenue__sum.0 > analytic.summary_revenue__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.summary_revenue__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
            <tr>
              <td>Средняя выручка</td>
              <td>{{ analytic.summary_revenue__avg.0 | intcomma }}</td>
              <td>{{ analytic.summary_revenue__avg.1 | intcomma }}</td>
              <td>
                {% if analytic.summary_revenue__avg.0 < analytic.summary_revenue__avg.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.summary_revenue__avg.2 }}%</span>
                {% elif analytic.summary_revenue__avg.0 > analytic.summary_revenue__avg.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.summary_revenue__avg.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
          </tbody>
        </table>
        <table class="table table-dark">
          <thead class="text-warning text-center">
            <th colspan="4">Пиковые показатели</th>
          </thead>
          <tbody class="text-center">
            <tr>
              <td>Макс. выручка</td>
              <td>{{ max_revenue_workshift.shift_date | date:"d.m.Y" }}<br>({{ max_revenue_workshift.shift_date | date:"l" }})</td>
              <td>{{ max_revenue_workshift.summary_revenue | intcomma }}</td>
              <td>
                {{ max_revenue_workshift.hall_admin.get_full_name }}<br>
                {{ max_revenue_workshift.cash_admin.get_full_name }}
              </td>
            </tr>
            <tr>
              <td>Мин. выручка</td>
              <td>{{ min_revenue_workshift.shift_date | date:"d.m.Y" }}<br>({{ min_revenue_workshift.shift_date | date:"l" }})</td>
              <td>{{ min_revenue_workshift.summary_revenue | intcomma }}</td>
              <td>
                {{ min_revenue_workshift.hall_admin.get_full_name }}<br>
                {{ min_revenue_workshift.cash_admin.get_full_name }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-md col-sm-12 m-2 table-responsive rounded border border-light">
        <p class="text-orange text-center fw-bold">Основные показатели выручки</p>
        <table class="table table-dark">
          <thead class="text-warning text-center">
            <tr>
              <th>Категория</th>
              <th>{{ previous_month_date|date:"F" }}</th>
              <th>{{ current_month_date|date:"F" }}</th>
              <th>Анализ</th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr>
              <td class="text-warning">Бар</td>
              <td>{{ analytic.bar_revenue__sum.0 | intcomma }}</td>
              <td>{{ analytic.bar_revenue__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.bar_revenue__sum.0 < analytic.bar_revenue__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.bar_revenue__sum.2 }}%</span>
                {% elif analytic.bar_revenue__sum.0 > analytic.bar_revenue__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.bar_revenue__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
            <tr>
              <td class="text-warning">Game Zone (КНА)</td>
              <td>{{ analytic.game_zone_subtotal__sum.0 | intcomma }}</td>
              <td>{{ analytic.game_zone_subtotal__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.game_zone_subtotal__sum.0 < analytic.game_zone_subtotal__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.game_zone_subtotal__sum.2 }}%</span>
                {% elif analytic.game_zone_subtotal__sum.0 > analytic.game_zone_subtotal__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.game_zone_subtotal__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
            <tr>
              <td class="text-warning">Доп. услуги</td>
              <td>{{ analytic.additional_services_revenue__sum.0 | intcomma }}</td>
              <td>{{ analytic.additional_services_revenue__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.additional_services_revenue__sum.0 < analytic.additional_services_revenue__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.additional_services_revenue__sum.2 }}%</span>
                {% elif analytic.additional_services_revenue__sum.0 > analytic.additional_services_revenue__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.additional_services_revenue__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
            <tr>
              <td class="text-warning">Кальян</td>
              <td>{{ analytic.hookah_revenue__sum.0 | intcomma }}</td>
              <td>{{ analytic.hookah_revenue__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.hookah_revenue__sum.0 < analytic.hookah_revenue__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.hookah_revenue__sum.2 }}%</span>
                {% elif analytic.hookah_revenue__sum.0 > analytic.hookah_revenue__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.hookah_revenue__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
          </tbody>
          <tfoot class="text-center">
            <tr>
              <td class="text-danger">Недостачи</td>
              <td>{{ analytic.shortage__sum.0 | intcomma }}</td>
              <td>{{ analytic.shortage__sum.1 | intcomma }}</td>
              <td>
                {% if analytic.shortage__sum.0 < analytic.shortage__sum.1 %}
                <span class="text-danger"><i class="fa-solid fa-arrow-trend-up"></i> рост на {{ analytic.shortage__sum.2 }}%</span>
                {% elif analytic.shortage__sum.0 > analytic.shortage__sum.1 %}
                <span class="text-acid"><i class="fa-solid fa-arrow-trend-down"></i> снижение на {{ analytic.shortage__sum.2 }}%</span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</main>
{% endblock %}