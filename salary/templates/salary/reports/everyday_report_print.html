{% extends 'salary/logined_page.html' %}
{% load humanize %}

{% block content %}
<main>
  <div class="container verysmall">
    <div class="row mt-1">
      <div class="col text-center text-secondary">
        Ежедневный отчет по смене<br>
        <b>{{ workshift.shift_date }}</b>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center verysmall">
        <table class="table table-dark table-report text-secondary table-bordered">
          <thead>
            <th>Дата закрытия смены:</th>
            <th>Смену сдали:</th>
          </thead>
          <tbody>
            <tr>
              <td>
               {{object.shift_date|date:"d.m.Y"}}<br><br>
                Технический отчет:
                {% if workshift.technical_report %}
                сдан
                {% else %}
                не сдан
                {% endif %}
              </td>
              <td>
                <table class="table table-dark text-secondary verysmall">
                  <thead>
                    <th>Администратор кассы</th>
                    <th>Администратор зала</th>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{workshift.cash_admin.get_full_name}}</td>
                      <td>{{workshift.hall_admin.get_full_name}}</td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center text-secondary">
        <b>Время прибытия смены</b>
        <table class="table table-dark text-center verysmall table-report text-secondary table-bordered">
          <thead>
            <th>Администратор кассы</th>
            <th>Администратор зала</th>
          </thead>
          <tbody>
            <tr>
              <td>{{workshift.next_cashier.get_full_name|default:"-"}}</td>
              <td>{{workshift.next_hall_admin.get_full_name|default:"-"}}</td>
            </tr>
            <tr>
              <td>{{workshift.cashier_arrival_time|default:"-"}}</td>
              <td>{{workshift.hall_admin_arrival_time|default:"-"}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center verysmall text-secondary">
        <b>Расходы и суммарные данные</b>
        <table class="table table-dark table-report text-secondary table-bordered">
          <thead>
            <th>Расходы (Наименование, сумма)</th>
            <th>Суммарные данные</th>
          </thead>
          <tbody>
            <tr>
              <td>
                <table class="table table-dark text-secondary">
                  <tbody>
                    {% for cost in workshift.costs.all %}
                    <tr>
                      <td>{{cost.cost_sum}}</td>
                      <td>{{cost.cost_reason}}</td>
                      <td>{{cost.cost_person.last_name}} _____________ (подпись)</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </td>
              <td>
                <table class="table table-dark text-secondary verysmall table-report text-start">
                  <thead>
                    <th>Наименование</th>
                    <th>Сумма</th>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Сумма эквайринга (терминал)</td>
                      <td>{{workshift.acquiring_terminal_sum}}</td>
                    </tr>
                    <tr>
                      <td>Сумма по эквайринга (Эватор)</td>
                      <td>{{workshift.acquiring_evator_sum}}</td>
                    </tr>
                    <tr>
                      <td>Сумма расходов</td>
                      <td>{{workshift.cost_sum}}</td>
                    </tr>
                    <tr>
                      <td>Сумма ошибок</td>
                      <td>{{workshift.game_zone_error}}</td>
                    </tr>
                    <tr>
                      <td>Сумма наличных</td>
                      <td>{{workshift.cash_sum}}</td>
                    </tr>
                    <tr>
                      <td>Сумма на сдачу</td>
                      <td>{{workshift.short_change_sum}}</td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center verysmall">
        <table class="table text-secondary table-dark table-report table-bordered">
          <thead>
            <th>Ошибки по кабинкам (время, №, причина, ошибочное время)</th>
            <th>Пожелания/примечания</th>
          </thead>
          <tr>
            <td class="text-secondary"><br><br><br><br></td>
            <td>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center text-secondary">
        <b>Пояснения к ошибкам KNA</b>
        <table class="table table-dark text-secondary verysmall table-report table-bordered">
          <thead>
            <th>Время по КНА</th>
            <th>Номер компьютера или карты</th>
            <th>Описание ошибки (подробное описание, была ли устранена)</th>
            <th>Сумма в рублях</th>
          </thead>
          <tbody>
            {% for error in workshift.errors.all %}
              {% if error.error_type == 'KNA' %}
              <tr>
                <td>{{ error.error_time }}</td>
                <td>{{ error.card }}</td>
                <td>{{ error.description }}</td>
                <td>{{ error.error_sum }}</td>
              </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center verysmall text-secondary">
        <b>Данные о бургерах, лото</b>
        <table class="table table-dark table-report verysmall text-secondary table-bordered">
          <thead>
            <th>Бургеры<br>(время, номер карты, сумма)</th>
            <th>Лото<br>(время, номер карты, сумма)</th>
          </thead>
          <tbody>
            <tr>
              <td>
                {% for error in workshift.errors.all %}
                  {% if error.error_type == 'BURGER' %}
                  {{ error.error_time }} - {{ error.card }} - {{ error.error_sum }};
                  {% endif %}
                {% endfor %}
              </td>
              <td>
                {% for error in workshift.errors.all %}
                  {% if error.error_type == 'LOTTO' %}
                  {{ error.error_time }} - {{ error.card }} - {{ error.error_sum }};
                  {% endif %}
                {% endfor %}
              </td>
            </tr>
            <tr><td>- р.</td><td>- р.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row mb-1">
      <div class="col text-center verysmall text-secondary">
        <b>Данные о приеме/сдаче</b>
        <table class="table table-dark table-report verysmall text-secondary text-start">
          <tbody>
            <tr><td colspan="2">Достоверность и корректность, указанных в отчете сведений, подтверждаю.</td></tr>
            <tr><td>Смену сдал: {{ workshift.cash_admin.get_full_name }}</td><td>Подпись: ____________</td></tr>
            <tr><td>Смену принял: {{ workshift.next_cashier.get_full_name }}</td><td>Подпись: ____________</td></tr>
            <tr><td colspan="2"><br></td></tr>
            <tr><td>Смену закрыл и проверил: _____________________________________________________________</td><td>Подпись: ____________</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>
{% endblock %}